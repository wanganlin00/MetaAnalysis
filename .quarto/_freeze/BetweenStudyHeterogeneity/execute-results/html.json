{
  "hash": "2705cc9f4e867d9e7afbb6186fe5485b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"研究间异质性\"\n---\n\n\n\n\nBetween-Study Heterogeneity $\\zeta_k$\n\n## Cochran's Q\n\nCochran's Q定义为每一项研究与总体效应的偏差**加权平方和** （weighted sum of squares, WSS）。\n\n$$\nQ=\\sum_{k=1}^K \\omega_k(\\hat \\theta_k - \\hat\\theta)^2\n$$\n\n当研究之间没有异质性即$\\zeta_k =0$ 仅有抽样误差，假设\n\n$$\n\\hat\\theta_k-\\hat\\theta\\sim N(0,1)\n$$\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123) # needed to reproduce results\nrnorm(n = 40, mean = 0, sd = 1)\n#>  [1] -0.56047565 -0.23017749  1.55870831  0.07050839  0.12928774  1.71506499\n#>  [7]  0.46091621 -1.26506123 -0.68685285 -0.44566197  1.22408180  0.35981383\n#> [13]  0.40077145  0.11068272 -0.55584113  1.78691314  0.49785048 -1.96661716\n#> [19]  0.70135590 -0.47279141 -1.06782371 -0.21797491 -1.02600445 -0.72889123\n#> [25] -0.62503927 -1.68669331  0.83778704  0.15337312 -1.13813694  1.25381492\n#> [31]  0.42646422 -0.29507148  0.89512566  0.87813349  0.82158108  0.68864025\n#> [37]  0.55391765 -0.06191171 -0.30596266 -0.38047100\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\nerror_fixed <- replicate(n = 10000, rnorm(40))\n\nhist(error_fixed, \n     xlab = expression(hat(theta[k])~-~hat(theta)), prob = TRUE, \n     breaks = 100, ylim = c(0, .45), xlim = c(-4,4),\n     main = \"No Heterogeneity\")\nlines(seq(-4, 4, 0.01), dnorm(seq(-4, 4, 0.01)), \n      col = \"blue\", lwd = 2)\n```\n\n::: {.cell-output-display}\n![](BetweenStudyHeterogeneity_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\n\n假设研究之间存在异质性 （$\\zeta_k$）和抽样误差（$\\epsilon_k$）\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\nerror_random <- replicate(n = 10000, rnorm(40) + rnorm(40))\nhist(error_random, \n     xlab = expression(hat(theta[k])~-~hat(theta)), prob = TRUE, \n     breaks = 100,ylim = c(0, .45), xlim = c(-4,4),\n     main = \"Heterogeneity\")\nlines(seq(-4, 4, 0.01), dnorm(seq(-4, 4, 0.01)), \n      col = \"blue\", lwd = 2)\n```\n\n::: {.cell-output-display}\n![](BetweenStudyHeterogeneity_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n\n计算Q，假设加权=1\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\nQ_fixed <- replicate(10000, sum(rnorm(40)^2))\nQ_random <- replicate(10000, sum((rnorm(40) + rnorm(40))^2))\n```\n:::\n\n\n\n\n自由度为K−1的卡方分布（其中K是我们荟萃分析中的研究数量）\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- 40-1\n\nhist(Q_fixed, xlab = expression(italic(\"Q\")), prob = TRUE, \n     breaks = 100, ylim = c(0, .06),xlim = c(0,160),\n     main = \"No Heterogeneity\")\nlines(seq(0, 100, 0.01), dchisq(seq(0, 100, 0.01), df = df), \n      col = \"blue\", lwd = 2)\n```\n\n::: {.cell-output-display}\n![](BetweenStudyHeterogeneity_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\n\nhist(Q_random,  xlab = expression(italic(\"Q\")), prob = TRUE, \n     breaks = 100, ylim = c(0, .06), xlim = c(0,160),\n     main = \"Heterogeneity\")\nlines(seq(0, 100, 0.01), dchisq(seq(0, 100, 0.01), df = df), \n      col = \"blue\", lwd = 2)\n```\n\n::: {.cell-output-display}\n![](BetweenStudyHeterogeneity_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n:::\n\n\n\n\n## **Higgins & Thompson’s** $I^2$Statistic\n\n$I^2$ 是另一种估计异质性的方法，基于Cochran's Q。 它被定义为不是由抽样误差引起的效应量的变异百分比\n\n$I^2$ 基于以下假设：在无异质性的零假设下，Q遵循具有K-1自由度的χ2分布。它以百分比的形式量化了在没有异质性（即K-1）的情况下，观察到的Q值超过预期Q值的程度。\n\n$$\nI^2=\\frac{Q-(K-1)}{Q}\n$$\n\nI2的值不能低于0%，因此如果Q恰好小于K-1，我们只需使用0而不是负值\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Display the value of the 10th simulation of Q\nQ_fixed[10]\n#> [1] 35.85787\n\n# Define k\nk <- 40\n\n# Calculate I^2\n(Q_fixed[10] - (k-1))/Q_fixed[10]\n#> [1] -0.08762746\n```\n:::\n\n\n\n\n$I^2$ = 0% 说明效应量的0%是由研究间的异质性引起的\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(Q_random[10] - (k-1))/Q_random[10]\n#> [1] 0.5692061\n```\n:::\n\n\n\n\n大约一半的差异是由于研究之间的异质性造成的。这也符合我们的预期，因为此示例中的变异同等程度地基于模拟的抽样误差和研究之间的异质性。\n\n-   I2 = 25%: low heterogeneity\n\n-   I2 = 50%: moderate heterogeneity\n\n-   I2 = 75%: substantial heterogeneity.\n\n## $H^2$ statistic\n\n它描述了由Q测量的观察到的变化与由于采样误差引起的预期变化的比率\n\n$$\nH^2=\\frac{Q}{K-1}\n$$\n\n当研究之间没有异质性时，H2等于1（或更小）。大于1的值表示研究之间存在异质性。\n\n## **Heterogeneity Variance** $\\tau^2$& Standard Deviation $\\tau$\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\nlibrary(meta)\nm.gen <- metagen(TE = TE,\n                 seTE = seTE,\n                 studlab = Author,\n                 data = dmetar::ThirdWave,\n                 sm = \"SMD\",\n                 fixed = FALSE,\n                 random = TRUE,\n                 method.tau = \"REML\",\n                 method.random.ci = \"HK\",\n                 title = \"Third Wave Psychotherapies\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Pooled effect\nm.gen$TE.random\n#> [1] 0.5771158\n\n# Estimate of tau\nm.gen$tau\n#> [1] 0.2863311\n```\n:::\n\n\n\n\n我们看到了g=0.58 和τ=0.29. 根据这些数据，我们可以计算出 95% 真实效应量置信区间的下限和上限：0.58−1.96×0.29 = 0.01 和 0.58 1.96+×0.29 = 1.15。\n\n## Prediction intervals (PIs) \n\n95% 预测区间的公式如下所示：\n\n![](images/clipboard-3273423715.png){fig-align=\"center\"}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm.gen <- update(m.gen, prediction = TRUE)\nsummary(m.gen)\n#> Review:     Third Wave Psychotherapies\n#> \n#>                           SMD            95%-CI %W(random)\n#> Call et al.            0.7091 [ 0.1979; 1.2203]        5.0\n#> Cavanagh et al.        0.3549 [-0.0300; 0.7397]        6.3\n#> DanitzOrsillo          1.7912 [ 1.1139; 2.4685]        3.8\n#> de Vibe et al.         0.1825 [-0.0484; 0.4133]        7.9\n#> Frazier et al.         0.4219 [ 0.1380; 0.7057]        7.3\n#> Frogeli et al.         0.6300 [ 0.2458; 1.0142]        6.3\n#> Gallego et al.         0.7249 [ 0.2846; 1.1652]        5.7\n#> Hazlett-Stevens & Oren 0.5287 [ 0.1162; 0.9412]        6.0\n#> Hintz et al.           0.2840 [-0.0453; 0.6133]        6.9\n#> Kang et al.            1.2751 [ 0.6142; 1.9360]        3.9\n#> Kuhlmann et al.        0.1036 [-0.2781; 0.4853]        6.3\n#> Lever Taylor et al.    0.3884 [-0.0639; 0.8407]        5.6\n#> Phang et al.           0.5407 [ 0.0619; 1.0196]        5.3\n#> Rasanen et al.         0.4262 [-0.0794; 0.9317]        5.1\n#> Ratanasiripong         0.5154 [-0.1731; 1.2039]        3.7\n#> Shapiro et al.         1.4797 [ 0.8618; 2.0977]        4.2\n#> Song & Lindquist       0.6126 [ 0.1683; 1.0569]        5.7\n#> Warnecke et al.        0.6000 [ 0.1120; 1.0880]        5.2\n#> \n#> Number of studies: k = 18\n#> \n#>                              SMD            95%-CI    t  p-value\n#> Random effects model (HK) 0.5771 [ 0.3782; 0.7760] 6.12 < 0.0001\n#> Prediction interval              [-0.0542; 1.2084]              \n#> \n#> Quantifying heterogeneity (with 95%-CIs):\n#>  tau^2 = 0.0820 [0.0295; 0.3533]; tau = 0.2863 [0.1717; 0.5944]\n#>  I^2 = 62.6% [37.9%; 77.5%]; H = 1.64 [1.27; 2.11]\n#> \n#> Test of heterogeneity:\n#>      Q d.f. p-value\n#>  45.50   17  0.0002\n#> \n#> Details of meta-analysis methods:\n#> - Inverse variance method\n#> - Restricted maximum-likelihood estimator for tau^2\n#> - Q-Profile method for confidence interval of tau^2 and tau\n#> - Calculation of I^2 based on Q\n#> - Hartung-Knapp adjustment for random effects model (df = 17)\n#> - Prediction interval based on t-distribution (df = 17)\n```\n:::\n\n\n\n\n在合并效应的直接作用下，我们看到了预测区间。其范围为g=-0.06至1.21。这意味着，根据目前的证据，未来的一些研究可能会发现负面的治疗效果。然而，间隔相当宽，这意味着也可能产生非常高的效果。\n\n## **异常值**\n\n### 删除\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndmetar::find.outliers(m.gen)\n#> Identified outliers (random-effects model) \n#> ------------------------------------------ \n#> \"DanitzOrsillo\", \"Shapiro et al.\" \n#>  \n#> Results with outliers removed \n#> ----------------------------- \n#> Review:     Third Wave Psychotherapies\n#> \n#> Number of studies: k = 16\n#> \n#>                              SMD           95%-CI    t  p-value\n#> Random effects model (HK) 0.4528 [0.3257; 0.5800] 7.59 < 0.0001\n#> Prediction interval              [0.1705; 0.7352]              \n#> \n#> Quantifying heterogeneity (with 95%-CIs):\n#>  tau^2 = 0.0139 [0.0000; 0.1032]; tau = 0.1180 [0.0000; 0.3213]\n#>  I^2 = 24.8% [0.0%; 58.7%]; H = 1.15 [1.00; 1.56]\n#> \n#> Test of heterogeneity:\n#>      Q d.f. p-value\n#>  19.95   15  0.1739\n#> \n#> Details of meta-analysis methods:\n#> - Inverse variance method\n#> - Restricted maximum-likelihood estimator for tau^2\n#> - Q-Profile method for confidence interval of tau^2 and tau\n#> - Calculation of I^2 based on Q\n#> - Hartung-Knapp adjustment for random effects model (df = 15)\n#> - Prediction interval based on t-distribution (df = 15)\n```\n:::\n\n\n\n\n### 影响分析\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm.gen.inf <- dmetar::InfluenceAnalysis(m.gen, random = TRUE)\n#> [===========================================================================] DONE\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(m.gen.inf, \"baujat\")\n```\n\n::: {.cell-output-display}\n![](BetweenStudyHeterogeneity_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(m.gen.inf, \"influence\")\n```\n\n::: {.cell-output-display}\n![](BetweenStudyHeterogeneity_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(m.gen.inf, \"es\")\n```\n\n::: {.cell-output-display}\n![](BetweenStudyHeterogeneity_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(m.gen.inf, \"i2\")\n```\n\n::: {.cell-output-display}\n![](BetweenStudyHeterogeneity_files/figure-html/unnamed-chunk-15-2.png){width=672}\n:::\n:::\n\n\n\n\n### **GOSH Plot Analysis**\n\nGraphic Display of Heterogeneity (GOSH) \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(metafor)\n\nm.rma <- rma(yi = m.gen$TE,\n             sei = m.gen$seTE,\n             method = m.gen$method.tau,\n             test = \"knha\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nres.gosh <- gosh(m.rma)\nsave(res.gosh,file = \"data/res.gosh.RData\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nload(\"data/res.gosh.RData\")\nplot(res.gosh, alpha = 0.01)\n```\n\n::: {.cell-output-display}\n![](BetweenStudyHeterogeneity_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n\n\nGOSH 诊断图\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#' @usage gosh.diagnostics(data, km = TRUE, db = TRUE, gmm = TRUE,\n#'                  km.params = list(centers = 3,\n#'                                   iter.max = 10, nstart = 1,\n#'                                   algorithm = c(\"Hartigan-Wong\",\n#'                                   \"Lloyd\", \"Forgy\",\"MacQueen\"),\n#'                                   trace = FALSE),\n#'                  db.params = list(eps = 0.15, MinPts = 5,\n#'                                   method = c(\"hybrid\", \"raw\", \"dist\")),\n#'                  gmm.params = list(G = NULL, modelNames = NULL,\n#'                                    prior = NULL, control = emControl(),\n#'                                    initialization = list(hcPairs = NULL,\n#'                                    subset = NULL,\n#'                                    noise = NULL),\n#'                                    Vinv = NULL,\n#'                                    warn = mclust.options(\"warn\"),\n#'                                    x = NULL, verbose = FALSE),\n#'                  seed = 123,\n#'                  verbose = TRUE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nres.gosh.diag <- dmetar::gosh.diagnostics(res.gosh, \n                                  km.params = list(centers = 2),\n                                  db.params = list(eps = 0.08, \n                                                   MinPts = 50))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(\"m.gosh\",package = \"dmetar\")\nres.diag <-dmetar::gosh.diagnostics(m.gosh)\n#>   \n#>  Perform Clustering... \n#>  |==========================================================================================| DONE\nres.diag \n#> GOSH Diagnostics \n#> ================================ \n#> \n#>  - Number of K-means clusters detected: 3\n#>  - Number of DBSCAN clusters detected: 4\n#>  - Number of GMM clusters detected: 4\n#> \n#>  Identification of potential outliers \n#>  --------------------------------- \n#> \n#>  - K-means: Study 3, Study 4\n#>  - DBSCAN: Study 3, Study 4\n#>  - Gaussian Mixture Model: Study 3\nplot(res.diag)\n```\n\n::: {.cell-output-display}\n![](BetweenStudyHeterogeneity_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](BetweenStudyHeterogeneity_files/figure-html/unnamed-chunk-21-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](BetweenStudyHeterogeneity_files/figure-html/unnamed-chunk-21-3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](BetweenStudyHeterogeneity_files/figure-html/unnamed-chunk-21-4.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](BetweenStudyHeterogeneity_files/figure-html/unnamed-chunk-21-5.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nupdate(m.gen, exclude = c(3, 4, 16)) %>% \n  summary()\n#> Review:     Third Wave Psychotherapies\n#> \n#>                           SMD            95%-CI %W(random) exclude\n#> Call et al.            0.7091 [ 0.1979; 1.2203]        4.6        \n#> Cavanagh et al.        0.3549 [-0.0300; 0.7397]        8.1        \n#> DanitzOrsillo          1.7912 [ 1.1139; 2.4685]        0.0       *\n#> de Vibe et al.         0.1825 [-0.0484; 0.4133]        0.0       *\n#> Frazier et al.         0.4219 [ 0.1380; 0.7057]       14.8        \n#> Frogeli et al.         0.6300 [ 0.2458; 1.0142]        8.1        \n#> Gallego et al.         0.7249 [ 0.2846; 1.1652]        6.2        \n#> Hazlett-Stevens & Oren 0.5287 [ 0.1162; 0.9412]        7.0        \n#> Hintz et al.           0.2840 [-0.0453; 0.6133]       11.0        \n#> Kang et al.            1.2751 [ 0.6142; 1.9360]        2.7        \n#> Kuhlmann et al.        0.1036 [-0.2781; 0.4853]        8.2        \n#> Lever Taylor et al.    0.3884 [-0.0639; 0.8407]        5.8        \n#> Phang et al.           0.5407 [ 0.0619; 1.0196]        5.2        \n#> Rasanen et al.         0.4262 [-0.0794; 0.9317]        4.7        \n#> Ratanasiripong         0.5154 [-0.1731; 1.2039]        2.5        \n#> Shapiro et al.         1.4797 [ 0.8618; 2.0977]        0.0       *\n#> Song & Lindquist       0.6126 [ 0.1683; 1.0569]        6.1        \n#> Warnecke et al.        0.6000 [ 0.1120; 1.0880]        5.0        \n#> \n#> Number of studies: k = 15\n#> \n#>                              SMD           95%-CI    t  p-value\n#> Random effects model (HK) 0.4819 [0.3595; 0.6043] 8.44 < 0.0001\n#> Prediction interval              [0.3623; 0.6016]              \n#> \n#> Quantifying heterogeneity (with 95%-CIs):\n#>  tau^2 < 0.0001 [0.0000; 0.0955]; tau = 0.0012 [0.0000; 0.3091]\n#>  I^2 = 4.6% [0.0%; 55.7%]; H = 1.02 [1.00; 1.50]\n#> \n#> Test of heterogeneity:\n#>      Q d.f. p-value\n#>  14.67   14  0.4011\n#> \n#> Details of meta-analysis methods:\n#> - Inverse variance method\n#> - Restricted maximum-likelihood estimator for tau^2\n#> - Q-Profile method for confidence interval of tau^2 and tau\n#> - Calculation of I^2 based on Q\n#> - Hartung-Knapp adjustment for random effects model (df = 14)\n#> - Prediction interval based on t-distribution (df = 14)\n```\n:::\n",
    "supporting": [
      "BetweenStudyHeterogeneity_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}